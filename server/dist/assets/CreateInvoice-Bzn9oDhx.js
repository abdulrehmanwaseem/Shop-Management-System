import{r as A,d as U,x as W,B as w,j as e,F as X,$ as Y,n as Z}from"./vendor-wvIh0B1Y.js";import{F as _,G as V,H as ee,E as te,J as ae,C as T,S as R,D as se,T as ne,c as Q,I as D,K as re,L as le}from"./index-DlEONuLy.js";import{u as oe}from"./expensesApi-B_ndxbIS.js";import{u as ie}from"./itemsApi-DkzMZ8Ja.js";const fe=()=>{const[F]=A.useState([]),[o,k]=A.useState(0),v=A.useRef(null),H=U(),L=["ID","Item","Rate","Quantity","Amount"],h=W({resolver:re,defaultValues:{discount:0,paidAmount:0,freight:0}});console.log(h.formState.errors);const a=h.watch("invoiceTypeId"),N=h.watch("paymentStatusId"),G=h.watch("freight"),q=h.watch("discount"),{data:C}=_(),{data:S}=V(),{data:r}=ie(),{data:x}=oe(),[O]=ee(),z=A.useMemo(()=>{var i,m,t;return a===1?(i=x==null?void 0:x.data)==null?void 0:i.map(c=>c.name.trim()):(t=a===3?(m=r==null?void 0:r.data)==null?void 0:m.filter(c=>c.stock>0):r==null?void 0:r.data)==null?void 0:t.map(c=>c.fullName)},[a,x,r]),B=[{data:"itemId",type:"numeric",allowInvalid:!1,strict:!0,readOnly:!0,width:30},{data:"name",type:"autocomplete",source:z,strict:!0,allowInvalid:!1},{data:"rate",type:"numeric",numericFormat:{pattern:"0,0.00"},strict:!0,allowInvalid:!1},{data:"quantity",type:"numeric",strict:!0,allowInvalid:!1},{data:"amount",type:"numeric",numericFormat:{pattern:"0,0.00"},readOnly:!0,allowInvalid:!1,strict:!0}],K=async i=>{var m;try{const t=(m=v==null?void 0:v.current)==null?void 0:m.hotInstance,{isGridEmpty:c,isError:E}=le(t);if(c){w.error("Please Add Items in table to submit");return}if(E){w.error("Please Review Table Data");return}const n=t==null?void 0:t.getSourceData().filter(u=>u.name&&u.itemId&&u.rate&&u.quantity&&u.amount);let y=0;if(a===3){const u=new Map(n.map(p=>[p.itemId,p.quantity]));y=r.data.reduce((p,s)=>{const b=u.get(s.id)||0;if(!b)return p;const j=s.purchasePrice*b;return p+j},0)}let{remainingAmount:d,paidAmount:l}=i,f=o+parseInt(G)-parseInt(q);N===1?(d=f-(l||0),l=l||0):N===2?(l=f,d=0):N===3&&(l=0,d=f);const I={...i,amount:o,items:n,finalAmount:f,remainingAmount:d,paidAmount:l,...a===3&&{revenue:parseInt(f)-parseInt(y)}};await O(I).unwrap().then(()=>{H("/invoices")})}catch(t){w.error("An error occurred, try again later"),console.log(t)}},{data:P}=te({invoiceType:a},{skip:!a}),$=A.useCallback((i,m)=>{var c;const t=(c=v.current)==null?void 0:c.hotInstance;if(m==="edit"||m==="CopyPaste.paste"){i==null||i.forEach(([n,y,d,l])=>{var f;if(y==="name"&&d!==l){const I=l?l.trim():"";if(t.getDataAtCol(1).filter((s,b)=>s&&b!==n).includes(I))t.setDataAtRowProp(n,y,d),w.error("Item already added, please choose a different item.");else{const s=a===1?x==null?void 0:x.data.find(g=>{var M;return((M=g==null?void 0:g.name)==null?void 0:M.trim())===I}):(f=r==null?void 0:r.data)==null?void 0:f.find(g=>g.fullName===I),b=0,j=2;t.setDataAtCell(n,b,s==null?void 0:s.id),a===2?t.setDataAtCell(n,j,s==null?void 0:s.purchasePrice):a===3&&t.setDataAtCell(n,j,s==null?void 0:s.salePrice)}}if((y==="rate"||y==="quantity")&&d!==l){const[I,u,p,s,b]=t.getDataAtRow(n);t.setDataAtCell(n,4,(p||0)*(s||0))}});const E=t==null?void 0:t.getSourceData().filter(n=>Object.keys(n).length>0);k(ae(E))}}),J=(i,m)=>{if(!a)return!1};return e.jsx(X,{...h,children:e.jsx("form",{onSubmit:h.handleSubmit(K),children:e.jsxs("div",{className:"space-y-4 ",children:[e.jsxs(T,{className:"space-y-4 shadow-lg",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Invoice"}),e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-4",children:[e.jsx(R,{label:"Invoice Type",name:"invoiceTypeId",placeholder:"Enter invoice name",options:C==null?void 0:C.data,filter:!1}),e.jsx(se,{label:"Invoice Date",name:"date"}),e.jsx(R,{label:"Invoice Name",name:"partyId",value:"id",isDisable:!a,placeholder:"Enter invoice name",options:P==null?void 0:P.data})]}),e.jsx(ne,{label:"Particular",name:"particular",placeholder:"Enter invoice particular"})]}),e.jsxs(T,{className:"space-y-4 max-h-fit shadow-lg",children:[e.jsxs("span",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Invoice Details"}),!a&&e.jsx("p",{className:"text-red-500 font-medium",children:'Please select an "invoice type" to enable the table.'})]}),e.jsx("hr",{}),e.jsx(Y,{data:F,ref:v,beforeChange:J,afterChange:$,colHeaders:L,columns:B,readOnly:!a,stretchH:"all",beforeRefreshDimensions:()=>!1,height:`${Math.min(F.length,10)*24+24}px`,contextMenu:!0,manualColumnResize:!0,manualRowResize:!0,rowHeaders:!0,minRows:10,minSpareRows:1,licenseKey:"non-commercial-and-evaluation"})]}),e.jsxs(T,{className:"space-y-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Payment Details"}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("span",{className:"text-lg font-semibold",children:["Sub Total: ",Q.format(o)]}),e.jsx("div",{class:"border-l-2 border-slate-500 h-6"}),e.jsxs("span",{className:"text-lg font-semibold",children:["Total Amount:"," ",Q.format(o+parseInt(G||0)-parseInt(q||0))]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[a===2&&e.jsx(D,{label:"Freight Amount",name:"freight",type:"number",maxLimit:o>0&&o-1,placeholder:"Enter freight amount"}),a!==1&&e.jsx(D,{label:"Discount Amount",name:"discount",type:"number",maxLimit:o>0&&o-1,placeholder:"Enter discount amount"}),e.jsx(R,{label:"Payment Status",name:"paymentStatusId",placeholder:"Enter invoice name",options:S==null?void 0:S.data,filter:!1}),N===1?e.jsx(D,{label:"Paid Amount",name:"paidAmount",type:"number",maxLimit:o>0&&o-1,placeholder:"Enter paid amount"}):null]}),e.jsx(Z,{label:"Submit",raised:!0,className:"w-full",size:"small",type:"submit"})]})]})})})};export{fe as default};
